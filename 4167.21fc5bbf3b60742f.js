"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4167],{580:(w,f,c)=>{c.d(f,{o:()=>v});var d=c(9863);let v=(()=>{class r{constructor(s){this.zone=s,this.loadingImg="assets/images/loading_default_large.png",this.errorImg="assets/images/img_404_large.png",this.src="",this.alt="",this.loadFinish=new d.vpe,this.loadError=new d.vpe,this.currentSrc="",this.timeoutToken=null}ngOnChanges(s){const l=this;this.src?(this.currentSrc=this.loadingImg,this.timeoutToken=setTimeout(()=>{this.timeoutToken=null;const m=new Image;m.onload=function(){l.zone.run(()=>{l.currentSrc=l.src}),l.loadFinish.emit(l.src)},m.onerror=function(){l.zone.run(()=>{l.currentSrc=l.errorImg}),l.loadError.emit(l.src)},m.src=this.src},0)):this.currentSrc=this.errorImg}ngOnInit(){}ngOnDestroy(){this.timeoutToken&&(clearTimeout(this.timeoutToken),this.timeoutToken=null)}}return r.\u0275fac=function(s){return new(s||r)(d.Y36(d.R0b))},r.\u0275cmp=d.Xpm({type:r,selectors:[["app-status-image"]],inputs:{loadingImg:"loadingImg",errorImg:"errorImg",src:"src",alt:"alt"},outputs:{loadFinish:"loadFinish",loadError:"loadError"},features:[d.TTD],decls:1,vars:1,consts:[[3,"src"]],template:function(s,l){1&s&&d._UZ(0,"img",0),2&s&&d.Q6J("src",l.currentSrc,d.LSH)},styles:["img[_ngcontent-%COMP%]{display:block;width:var(--width, 100%);height:var(--height, inherit);object-fit:var(--object-fit, contain);object-position:var(--object-position, center)}"]}),r})()},5732:(w,f,c)=>{c.d(f,{$:()=>v});var d=c(9863);let v=(()=>{class r{constructor(){}ngOnInit(){}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=d.Xpm({type:r,selectors:[["app-wechat-open-page"]],decls:7,vars:0,consts:[[1,"weui-mask"],[1,"weui-dialog"],[1,"weui-dialog__bd"],[1,"weui-dialog__ft"],["href","weixin://","onclick","",1,"weui-dialog__btn","weui-dialog__btn_default"]],template:function(s,l){1&s&&(d.TgZ(0,"div",0)(1,"div",1)(2,"div",2),d._uU(3,"\u8bf7\u5728\u624b\u673a\u7aef\u6253\u5f00\u9875\u9762"),d.qZA(),d.TgZ(4,"div",3)(5,"a",4),d._uU(6,"\u786e\u5b9a"),d.qZA()()()())},styles:[""]}),r})()},4167:(w,f,c)=>{c.r(f),c.d(f,{ZooCheckInPageModule:()=>at});var d=c(9808),v=c(3075),r=c(8962),p=c(1192),s=c(655),l=c(4157),m=c(7846),P=c(5098),b=c(28),t=c(9863);function T(o,a){if(1&o&&(t.TgZ(0,"span",11),t._uU(1),t.qZA()),2&o){const n=t.oxw();t.xp6(1),t.Oqu(n.messageDone)}}function Z(o,a){if(1&o){const n=t.EpF();t.TgZ(0,"div",12)(1,"ion-button",13),t.NdJ("click",function(){return t.CHM(n),t.oxw().onClickActionItem(0)}),t._uU(2),t.qZA()()}if(2&o){const n=t.oxw();t.xp6(2),t.hij(" ",n.okText," ")}}function S(o,a){if(1&o){const n=t.EpF();t.TgZ(0,"div",14),t.NdJ("click",function(){return t.CHM(n),t.oxw().onClickCloseDialog()}),t._UZ(1,"ion-icon",15),t.qZA()}}let R=(()=>{class o extends b.I{constructor(n,e){super(n,e),this.toastCtrl=n,this.modalCtrl=e,this.title="\u6253\u5361\u6210\u529f",this.message="",this.messageDone="\u60a8\u5df2\u5b8c\u6210\u6240\u6709\u6253\u5361\uff0c\u5feb\u53bb\u9886\u5956\u54c1\u5427\uff01",this.okText="\u597d\u7684",this.showActions=!0,this.showCloseButton=!0,this.isShowDone=!1}onClickActionItem(n){(()=>(0,s.mG)(this,void 0,void 0,function*(){(yield this.modalCtrl.getTop()).dismiss(0===n?o.RESULT_OK:o.RESULT_CANCEL)}))().catch(console.error)}}return o.RESULT_OK="OK",o.RESULT_CANCEL="CANCEL",o.\u0275fac=function(n){return new(n||o)(t.Y36(r.yF),t.Y36(r.IN))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-zoo-checkin-success-dialog"]],inputs:{title:"title",message:"message",messageDone:"messageDone",okText:"okText",showActions:"showActions",showCloseButton:"showCloseButton",isShowDone:"isShowDone"},features:[t.qOj],decls:14,vars:5,consts:[[1,"dialog-wrapper"],[1,"dialog-content"],[1,"dialog-title"],[1,"dialog-body"],[1,"content"],[1,"success-icon"],["src","assets/images/zoo/check-in-success.png"],[1,"text"],["class","done",4,"ngIf"],["class","actions",4,"ngIf"],["class","close-button",3,"click",4,"ngIf"],[1,"done"],[1,"actions"],["color","primary","expand","block","fill","solid",3,"click"],[1,"close-button",3,"click"],["name","close-outline"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),t._uU(4),t.qZA()(),t.TgZ(5,"div",3)(6,"div",4)(7,"div",5),t._UZ(8,"img",6),t.qZA(),t.TgZ(9,"span",7),t._uU(10),t.qZA(),t.YNc(11,T,2,1,"span",8),t.qZA(),t.YNc(12,Z,3,1,"div",9),t.qZA()(),t.YNc(13,S,2,0,"div",10),t.qZA()),2&n&&(t.xp6(4),t.Oqu(e.title),t.xp6(6),t.Oqu(e.message),t.xp6(1),t.Q6J("ngIf",e.isShowDone),t.xp6(1),t.Q6J("ngIf",e.showActions),t.xp6(1),t.Q6J("ngIf",e.showCloseButton))},directives:[d.O5,r.YG,r.gu],styles:[".flex-col[_ngcontent-%COMP%]{display:flex;flex-direction:column}.flex-row[_ngcontent-%COMP%]{display:flex;flex-direction:row}.justify-start[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.justify-center[_ngcontent-%COMP%]{display:flex;justify-content:center}.justify-end[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.justify-evenly[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.justify-around[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.justify-between[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.align-start[_ngcontent-%COMP%]{display:flex;align-items:flex-start}.align-center[_ngcontent-%COMP%]{display:flex;align-items:center}.align-end[_ngcontent-%COMP%]{display:flex;align-items:flex-end}div.dialog-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:20px;box-sizing:border-box;width:100%;min-height:400px;background-color:#f8f8f8}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;width:100%}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-title[_ngcontent-%COMP%]{font-size:24px;font-weight:700}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%]{margin-top:20px}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.content[_ngcontent-%COMP%]{width:100%;min-height:100px;padding:40px 30px;display:flex;flex-direction:column;align-items:center;justify-content:center}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.content[_ngcontent-%COMP%] > div.success-icon[_ngcontent-%COMP%]{margin-top:0;margin-bottom:20px}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.content[_ngcontent-%COMP%] > div.success-icon[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:46px;height:46px}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.content[_ngcontent-%COMP%] > span.text[_ngcontent-%COMP%]{font-size:16px;color:#3d464f}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.content[_ngcontent-%COMP%] > span.done[_ngcontent-%COMP%]{font-size:16px;color:#ff4d4f}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:260px;margin:40px auto 0;padding-top:20px}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.actions[_ngcontent-%COMP%] > ion-button[_ngcontent-%COMP%]:nth-of-type(1){width:auto;height:46px;flex:1;font-size:14px}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.actions[_ngcontent-%COMP%] > ion-button[_ngcontent-%COMP%]:nth-of-type(2){width:auto;height:46px;flex:1;margin-left:20px}div.dialog-wrapper[_ngcontent-%COMP%] > div.close-button[_ngcontent-%COMP%]{position:absolute;right:20px;top:20px;cursor:pointer}div.dialog-wrapper[_ngcontent-%COMP%] > div.close-button[_ngcontent-%COMP%]:hover > ion-icon[_ngcontent-%COMP%]{color:#e2aa6f}div.dialog-wrapper[_ngcontent-%COMP%] > div.close-button[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{font-size:24px;color:#3d464f}@media screen and (max-width: 767px){div.dialog-wrapper[_ngcontent-%COMP%]{position:relative;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:left top;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:0 20px;box-sizing:border-box;width:100%;height:100%;min-height:200px;background-color:#f8f8f8}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;width:100%}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-title[_ngcontent-%COMP%]{font-size:20px;font-weight:700}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%]{margin-top:20px}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.content[_ngcontent-%COMP%]{width:100%;padding:0;min-height:60px}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.content[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:16px}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:260px;margin:20px auto 0}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.actions[_ngcontent-%COMP%] > ion-button[_ngcontent-%COMP%]:nth-of-type(1){width:auto;height:46px;flex:1;font-size:14px}div.dialog-wrapper[_ngcontent-%COMP%] > div.dialog-content[_ngcontent-%COMP%] > div.dialog-body[_ngcontent-%COMP%] > div.actions[_ngcontent-%COMP%] > ion-button[_ngcontent-%COMP%]:nth-of-type(2){width:auto;height:46px;flex:1;margin-left:40px}div.dialog-wrapper[_ngcontent-%COMP%] > div.close-button[_ngcontent-%COMP%]{position:absolute;right:10px;top:10px;cursor:pointer}div.dialog-wrapper[_ngcontent-%COMP%] > div.close-button[_ngcontent-%COMP%]:hover > ion-icon[_ngcontent-%COMP%]{color:#e2aa6f}div.dialog-wrapper[_ngcontent-%COMP%] > div.close-button[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{font-size:24px;color:#3d464f}}"]}),o})();var O=c(296),I=c(2752),x=c(8995),j=c(6793),A=c(947),D=c(9993),F=c(5830),z=c(4828),E=c(9609),J=c(5161),U=c(5732),B=c(580),N=c(7873);const Q=["appStatusContent"];function Y(o,a){if(1&o){const n=t.EpF();t.ynx(0),t.TgZ(1,"app-status-content",3,4),t.NdJ("retry",function(){return t.CHM(n),t.oxw().onRetry()}),t._UZ(3,"app-wechat-open-page"),t.qZA(),t.BQk()}}function L(o,a){if(1&o){const n=t.EpF();t.ynx(0),t.TgZ(1,"app-status-content",3,4),t.NdJ("retry",function(){return t.CHM(n),t.oxw().onRetry()}),t.TgZ(3,"div",5),t._uU(4,"pad layout here"),t.qZA()(),t.BQk()}}function G(o,a){if(1&o){const n=t.EpF();t.TgZ(0,"div",16),t.NdJ("click",function(){return t.CHM(n),t.oxw(3).onClickCheckIn()}),t.TgZ(1,"span"),t._uU(2,"\u672a\u6253\u5361"),t.qZA()()}}function H(o,a){1&o&&t._UZ(0,"ion-icon",17)}const W=function(o){return{active:o}};function q(o,a){if(1&o&&(t.TgZ(0,"div",13)(1,"div",6),t._UZ(2,"app-status-image",7),t.YNc(3,G,3,0,"div",14),t.qZA(),t.TgZ(4,"span"),t.YNc(5,H,1,0,"ion-icon",15),t._uU(6),t.qZA()()),2&o){const n=a.$implicit;t.Q6J("ngClass",t.VKq(5,W,n.isCheckIn)),t.xp6(2),t.Q6J("src",n.thumbnail),t.xp6(1),t.Q6J("ngIf",!n.isCheckIn),t.xp6(2),t.Q6J("ngIf",n.isCheckIn),t.xp6(1),t.hij(" ",n.name," ")}}function K(o,a){if(1&o){const n=t.EpF();t.ynx(0),t.TgZ(1,"app-status-content",3,4),t.NdJ("retry",function(){return t.CHM(n),t.oxw().onRetry()}),t.TgZ(3,"div",5)(4,"div",6),t._UZ(5,"img",7),t.qZA(),t.TgZ(6,"div",8)(7,"div",9),t.NdJ("click",function(){return t.CHM(n),t.oxw().onClickShowRemarks()}),t.TgZ(8,"span"),t._uU(9,"\u6d3b\u52a8\u89c4\u5219\u8bf4\u660e"),t.qZA()()(),t.TgZ(10,"div",10)(11,"div",11),t.YNc(12,q,7,7,"div",12),t.qZA()()()(),t.BQk()}if(2&o){const n=t.oxw();t.xp6(5),t.Q6J("src",n.activityInfo.thumbnail,t.LSH),t.xp6(7),t.Q6J("ngForOf",n.checkInList)}}function $(o,a){if(1&o){const n=t.EpF();t.TgZ(0,"div",21),t.NdJ("click",function(){return t.CHM(n),t.oxw(2).onClickCheckIn()}),t.TgZ(1,"div",22),t._UZ(2,"ion-icon",23),t.TgZ(3,"span"),t._uU(4," \u626b\u7801\u6253\u5361 "),t.qZA()()()}}function X(o,a){if(1&o){const n=t.EpF();t.TgZ(0,"div",24),t.NdJ("click",function(){return t.CHM(n),t.oxw(2).onClickReceiveCoupon()}),t.TgZ(1,"span"),t._uU(2,"\u9886\u53d6\u6570\u5b57\u85cf\u54c1\u7acb\u51cf\u5238"),t.qZA()()}}function V(o,a){if(1&o){const n=t.EpF();t.TgZ(0,"div",24),t.NdJ("click",function(){return t.CHM(n),t.oxw(2).onClickReceiveCoupon()}),t.TgZ(1,"span"),t._uU(2,"\u6253\u5361\u6210\u529f\uff0c\u9a6c\u4e0a\u5151\u6362"),t.qZA()()}}function tt(o,a){if(1&o){const n=t.EpF();t.TgZ(0,"div",24),t.NdJ("click",function(){return t.CHM(n),t.oxw(2).onClickGotoProfile()}),t.TgZ(1,"span"),t._uU(2,"\u85cf\u54c1\u5df2\u5151\u6362\uff0c\u73b0\u5728\u53bb\u770b\u770b"),t.qZA()()}}function nt(o,a){1&o&&(t.TgZ(0,"div",25)(1,"div",22)(2,"span"),t._uU(3,"\u6d3b\u52a8\u5df2\u7ecf\u7ed3\u675f"),t.qZA()()())}function et(o,a){if(1&o&&(t.TgZ(0,"ion-footer"),t.YNc(1,$,5,0,"div",18),t.YNc(2,X,3,0,"div",19),t.YNc(3,V,3,0,"div",19),t.YNc(4,tt,3,0,"div",19),t.YNc(5,nt,4,0,"div",20),t.qZA()),2&o){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",!n.isDone&&!n.activityInfo.isOver),t.xp6(1),t.Q6J("ngIf",n.isDone&&!n.activityInfo.isOver&&n.activityInfo.isJoined&&!n.isReceive),t.xp6(1),t.Q6J("ngIf",n.isDone&&!n.activityInfo.isOver&&n.activityInfo.isJoined&&n.isReceive&&!n.isUseReward),t.xp6(1),t.Q6J("ngIf",n.isDone&&!n.activityInfo.isOver&&n.activityInfo.isJoined&&n.isReceive&&n.isUseReward),t.xp6(1),t.Q6J("ngIf",n.activityInfo.isOver)}}const ot=[{path:"",component:(()=>{class o extends m.n{constructor(n,e,i,g,u,_,h,M,C,y,k){super(n,e,i,g),this.loadingCtrl=n,this.toastCtrl=e,this.runtime=i,this.screenFitService=g,this.navCtrl=u,this.modalCtrl=_,this.api=h,this.router=M,this.eventBus=C,this.themeService=y,this.routeInfo=k,this.subscribeResult=null,this.routeInfoSubscribeResult=null,this.activityId="",this.activityInfo={},this.checkInList=[],this.isDone=!1,this.isUseReward=!1,this.isReceive=!1,this.bookId="",this.reload="",this.sceneName="",this.wechatConfig=null,this.jsApiList=["checkJsApi","scanQRCode"]}ngOnInit(){this.subscribeResult=this.router.events.subscribe(n=>{n instanceof p.m2&&"/zoo-check-in"==n.url&&this.setPageTitle("\u666f\u70b9\u6253\u5361")}),this.routeInfoSubscribeResult=this.routeInfo.params.subscribe(n=>{this.activityId=n.activityId}),this.routeInfo.queryParams.subscribe(n=>{this.reload=n.reload})}ngOnDestroy(){this.subscribeResult&&(this.subscribeResult.unsubscribe(),this.subscribeResult=null),this.routeInfoSubscribeResult&&(this.routeInfoSubscribeResult.unsubscribe(),this.routeInfoSubscribeResult=null)}initData(){return(0,s.mG)(this,void 0,void 0,function*(){yield this.fetchConfigInfo(!1),yield Promise.all([this.fetchActivityInfo(),this.fetchCheckInList()]),this.appStatusContent.invokeSuccess(),I.E.isEmpty(this.reload)||x.w.isWechatBrowser()&&this.scanQRCode()})}setPageTitle(n){super.setPageTitle(n),this.eventBus.emmitEvent("changeNavTitle",n),this.eventBus.emmitEvent("changeDefaultHeader","standard"),this.eventBus.emmitEvent("changeShowRightBar","none")}ionViewWillEnter(){this.setPageTitle("\u666f\u70b9\u6253\u5361")}ionViewDidEnter(){(()=>(0,s.mG)(this,void 0,void 0,function*(){yield this.initData()}))().catch(n=>{console.error("[init data errror]",n),this.appStatusContent.invokeError()})}showTipsForSuccess(){return(0,s.mG)(this,void 0,void 0,function*(){const n=this.isDone,e=yield this.modalCtrl.create({component:R,cssClass:"common-dialog",showBackdrop:!0,backdropDismiss:!1,componentProps:{title:"\u6253\u5361\u6210\u529f",message:`\u606d\u559c\u60a8\uff0c${this.sceneName}\u6253\u5361\u6210\u529f`,messageDone:"\u60a8\u5df2\u5b8c\u6210\u6240\u6709\u6253\u5361\uff0c\u5feb\u53bb\u9886\u5956\u54c1\u5427\uff01",okText:"\u597d\u7684",isDone:n}});yield e.present(),yield e.onDidDismiss()})}onRetry(){(()=>(0,s.mG)(this,void 0,void 0,function*(){yield this.initData()}))().catch(n=>{console.error("[init data errror]",n),this.appStatusContent.invokeError()})}back(){this.navCtrl.back()}onClickCheckIn(){this.activityInfo.isOver||this.isDone||(x.w.isWechatBrowser()?this.scanQRCode():this.openCodeScanner())}openCodeScanner(){(()=>(0,s.mG)(this,void 0,void 0,function*(){const n=yield this.modalCtrl.create({component:j.q,cssClass:"code-scanner-dialog"});yield n.present();const e=yield n.onDidDismiss();e.data?this.analyzeScanResult(e.data):"error"==e.role&&setTimeout(()=>{location.reload()},500)}))().catch(n=>{console.error(n)})}onClickReceiveCoupon(){(()=>(0,s.mG)(this,void 0,void 0,function*(){yield this.doReceiveCoupon()}))().catch(n=>{console.error(n),this.showToast(`\u9886\u53d6\u5931\u8d25[${n.message}]`)})}onClickGotoProfile(){this.router.navigate(["/tabs/profile"],{queryParams:{menu:"center",index:2},replaceUrl:!0})}showCouponInfo(n,e){(()=>(0,s.mG)(this,void 0,void 0,function*(){const i=yield this.modalCtrl.create({component:O.h,cssClass:"common-dialog",componentProps:{title:"\u9886\u53d6\u6210\u529f",message:`\u606d\u559c\u60a8\uff0c\u6210\u529f\u9886\u53d6${n}\uff0c\u5feb\u53bb\u770b\u770b\u5427`,okText:"\u9a6c\u4e0a\u53bb\u5151\u6362",singleButton:!0}});yield i.present(),(yield i.onDidDismiss()).data==O.h.RESULT_OK&&this.router.navigate(["/artwork-detail",e])}))().catch(i=>{console.error(i)})}doCheckIn(n){return(0,s.mG)(this,void 0,void 0,function*(){const e=(0,l.d8)(P.y,yield this.api.checkIn(this.activityId,n));if(200!=e.code)return Promise.reject({code:e.code,message:e.msg});this.sceneName=e.data.title,yield this.fetchCheckInList(),yield this.showTipsForSuccess()})}doReceiveCoupon(){return(0,s.mG)(this,void 0,void 0,function*(){const n=(0,l.d8)(P.y,yield this.api.receiveCoupon(this.activityId));if(200==n.code){const e=n.data;this.showCouponInfo(e.couponName,e.bookId)}else{if(622!=n.code)return Promise.reject({code:n.code,message:n.msg});this.router.navigate(["/artwork-detail",n.data.bookId])}})}fetchActivityInfo(){return(0,s.mG)(this,void 0,void 0,function*(){const n=(0,l.d8)(P.y,yield this.api.fetchActivityInfo(this.activityId));if(200!=n.code)return Promise.reject({code:n.code,message:n.msg});{const{uid:e,title:i,thumbnail:g,description:u,content:_,price:h,startTime:M,endTime:C,isJoined:y,isOver:k,isUseReward:rt,isReceive:dt,bookId:gt}=n.data;this.activityInfo={uid:e,title:i,thumbnail:g,description:u,content:_,price:h,startTime:M,endTime:C,isJoined:y,isOver:k,isUseReward:rt,isReceive:dt,bookId:gt}}})}fetchCheckInList(){return(0,s.mG)(this,void 0,void 0,function*(){const n=(0,l.d8)(P.y,yield this.api.fetchCheckInList(this.activityId));if(200!=n.code)return Promise.reject({code:n.code,message:n.msg});{this.checkInList=[];const e=n.data;this.isDone=e.isDone,this.isUseReward=e.isUseReward,this.isReceive=e.isReceive,this.bookId=e.bookId;const i=e.items;i&&i.length>0&&i.forEach(g=>{this.checkInList.push({uid:g.uid,thumbnail:g.thumbnail,name:g.name,description:g.description,isCheckIn:g.isCheckIn})})}})}analyzeScanResult(n){if(!I.E.isEmpty(n)&&n.indexOf("scene")>-1){const e=n.split("?");if(e&&e.length>1){const g=e[1].split("&");if(g&&g.length>0)for(let u=0;u<g.length;u++){const _=g[u];if(_.indexOf("scene")>-1){const h=_.split("=");if(h&&h.length>1){const M=h[1];(()=>(0,s.mG)(this,void 0,void 0,function*(){yield this.doCheckIn(M)}))().catch(C=>{console.error(C),this.showToast(`\u6253\u5361\u5931\u8d25[${C.message}]`)})}break}}}}else this.showToast("\u65e0\u6548\u7801\uff0c\u8bf7\u4e0e\u5de5\u4f5c\u4eba\u5458\u8054\u7cfb")}scanQRCode(){(()=>(0,s.mG)(this,void 0,void 0,function*(){yield this.fetchConfigInfo(!0)}))().catch(n=>{console.error(n),this.showToast(`\u51fa\u9519\u4e86[${n.message}]`)})}initWeiXinJsSdk(){wx.config({debug:!1,appId:this.wechatConfig.appId,timestamp:this.wechatConfig.timestamp,nonceStr:this.wechatConfig.nonceStr,signature:this.wechatConfig.signature,jsApiList:["checkJsApi","scanQRCode"]}),wx.ready(()=>{wx.scanQRCode({needResult:1,scanType:["qrCode"],success:n=>{this.analyzeScanResult(n.resultStr)},fail:n=>{if(n.errMsg.indexOf("function_not_exist")>0)alert("\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u626b\u7801\uff0c\u8bf7\u8fdb\u884c\u5347\u7ea7");else{const e=x.w.convertRouteURL(this.router,["/zoo-check-in",this.activityId],{queryParams:{reload:"1"}});window.location.href=e}}})}),wx.error(n=>{})}fetchConfigInfo(n){return(0,s.mG)(this,void 0,void 0,function*(){const e=location.href.split("#")[0];this.jsApiList=[];const i=(0,l.d8)(P.y,yield this.api.fetchWechatJsSDKSign(e));if(200!==i.code)return Promise.reject({code:i.code,message:i.msg});{const g=i.data;this.wechatConfig={appId:g.appId,timestamp:g.timestamp,nonceStr:g.nonceStr,signature:g.signature},n&&setTimeout(()=>{this.initWeiXinJsSdk()},300)}})}onClickShowRemarks(){(()=>(0,s.mG)(this,void 0,void 0,function*(){const n=yield this.modalCtrl.create({component:O.h,cssClass:"common-dialog",componentProps:{title:"\u6d3b\u52a8\u89c4\u5219\u8bf4\u660e",message:"\u7528\u6237\u9700\u5728\u6df1\u5733\u91ce\u751f\u52a8\u7269\u56ed\u6307\u5b9a\u7684\u6253\u5361\u70b9\u4f4d\u7f6e\uff0c\u5bfb\u627e\u6d3b\u52a8\u4e8c\u7ef4\u7801\uff0c\u5e76\u626b\u7801\u6253\u5361\u5bf9\u5e94\u7684\u573a\u666f\u3002\u5c06\u6240\u6709\u573a\u666f\u6253\u5361\u5b8c\u6210\u540e\uff0c\u5c06\u53ef\u83b7\u5f97\u4ef7\u503c99.9\u5143\u7684\u6570\u5b57\u85cf\u54c1\u7acb\u51cf\u5238\uff0c\u4ee5\u53ca\u52a8\u7269\u56ed\u5b9a\u5236\u5c0f\u793c\u54c1\u3002",okText:"\u77e5\u9053\u4e86",singleButton:!0}});yield n.present(),yield n.onDidDismiss()}))().catch(n=>{console.error(n)})}}return o.\u0275fac=function(n){return new(n||o)(t.Y36(r.HT),t.Y36(r.yF),t.Y36(A.t),t.Y36(D.v),t.Y36(r.SH),t.Y36(r.IN),t.Y36(F.s),t.Y36(p.F0),t.Y36(z.Y),t.Y36(E.f),t.Y36(p.gz))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-zoo-check-in"]],viewQuery:function(n,e){if(1&n&&t.Gf(Q,5),2&n){let i;t.iGM(i=t.CRH())&&(e.appStatusContent=i.first)}},features:[t.qOj],decls:7,vars:10,consts:[["id","pageContent",3,"fullscreen","scrollEvents"],[1,"page-root","zoo-check-in"],[4,"ngIf"],[3,"retry"],["appStatusContent",""],[1,"app-container"],[1,"thumbnail"],[3,"src"],[1,"header"],[1,"box",3,"click"],[1,"content"],[1,"modules-wrapper"],["class","module",3,"ngClass",4,"ngFor","ngForOf"],[1,"module",3,"ngClass"],["class","mask-layer",3,"click",4,"ngIf"],["name","checkmark-outline",4,"ngIf"],[1,"mask-layer",3,"click"],["name","checkmark-outline"],["class","footer-grey",3,"click",4,"ngIf"],["class","footer-green",3,"click",4,"ngIf"],["class","footer-grey",4,"ngIf"],[1,"footer-grey",3,"click"],[1,"box"],["name","scan"],[1,"footer-green",3,"click"],[1,"footer-grey"]],template:function(n,e){1&n&&(t.TgZ(0,"ion-content",0)(1,"div",1),t.YNc(2,Y,4,0,"ng-container",2),t.YNc(3,L,5,0,"ng-container",2),t.YNc(4,K,13,2,"ng-container",2),t.qZA(),t._UZ(5,"app-common-footer"),t.qZA(),t.YNc(6,et,6,5,"ion-footer",2)),2&n&&(t.Tol(e.screenFitService.screenCategory),t.Q6J("fullscreen",e.themeService.immersive)("scrollEvents",!0),t.xp6(1),t.Tol(e.screenFitService.screenCategory),t.xp6(1),t.Q6J("ngIf","desktop"==e.screenFitService.screenCategory),t.xp6(1),t.Q6J("ngIf","pad"==e.screenFitService.screenCategory),t.xp6(1),t.Q6J("ngIf","phone"==e.screenFitService.screenCategory),t.xp6(2),t.Q6J("ngIf","phone"==e.screenFitService.screenCategory))},directives:[r.W2,d.O5,J.D,U.$,d.sg,d.mk,B.o,r.gu,N.X,r.fr],styles:['@charset "UTF-8";.flex-col[_ngcontent-%COMP%]{display:flex;flex-direction:column}.flex-row[_ngcontent-%COMP%]{display:flex;flex-direction:row}.justify-start[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.justify-center[_ngcontent-%COMP%]{display:flex;justify-content:center}.justify-end[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.justify-evenly[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.justify-around[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.justify-between[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.align-start[_ngcontent-%COMP%]{display:flex;align-items:flex-start}.align-center[_ngcontent-%COMP%]{display:flex;align-items:center}.align-end[_ngcontent-%COMP%]{display:flex;align-items:flex-end}div.page-root.zoo-check-in[_ngcontent-%COMP%]{position:relative;background-color:#2b333a;color:#fff;letter-spacing:2px;font-size:16px}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]{background-color:#2b333a}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]{padding:0}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.thumbnail[_ngcontent-%COMP%]{position:relative;width:100%;height:180px}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.thumbnail[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{display:block;width:100%;height:180px;object-fit:var(--object-fit, cover);object-position:var(--object-position, center)}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.thumbnail[_ngcontent-%COMP%]:after{position:absolute;display:block;content:"";width:100%;height:30%;left:0;bottom:0}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%] > div.header[_ngcontent-%COMP%]{width:100%;margin-top:20px;display:flex;align-items:center;justify-content:center}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%] > div.header[_ngcontent-%COMP%] > div.box[_ngcontent-%COMP%]{width:236px;height:50px;background:#4F5A65;border-radius:10px;display:flex;align-items:center;justify-content:center}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%] > div.header[_ngcontent-%COMP%] > div.box[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{height:22px;font-size:16px;font-weight:600;color:#fff;line-height:22px}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%]{width:100%}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.modules-wrapper[_ngcontent-%COMP%]{width:100%}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.modules-wrapper[_ngcontent-%COMP%] > div.module[_ngcontent-%COMP%]{margin:20px 0 0 4%;display:inline-block;width:44%;text-align:center}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.modules-wrapper[_ngcontent-%COMP%] > div.module.active[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{color:#e2aa6f}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.modules-wrapper[_ngcontent-%COMP%] > div.module[_ngcontent-%COMP%] > div.thumbnail[_ngcontent-%COMP%]{position:relative;width:100%;height:33vw;background-color:#fff6;padding:5px}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.modules-wrapper[_ngcontent-%COMP%] > div.module[_ngcontent-%COMP%] > div.thumbnail[_ngcontent-%COMP%] > div.mask-layer[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.modules-wrapper[_ngcontent-%COMP%] > div.module[_ngcontent-%COMP%] > div.thumbnail[_ngcontent-%COMP%] > div.mask-layer[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:block;color:#fff;font-weight:600}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.modules-wrapper[_ngcontent-%COMP%] > div.module[_ngcontent-%COMP%] > div.thumbnail[_ngcontent-%COMP%] > app-status-image[_ngcontent-%COMP%]{display:block;width:100%;height:100%;--height: 100%;--object-fit: cover;--object-position: center}div.page-root.zoo-check-in.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.modules-wrapper[_ngcontent-%COMP%] > div.module[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:block;text-align:center;font-weight:600;color:#fff;margin-top:10px;font-size:15px}ion-footer[_ngcontent-%COMP%]{width:100%;background:transparent}ion-footer[_ngcontent-%COMP%] > div.footer-green[_ngcontent-%COMP%]{width:100%;background:#53B24F;box-shadow:0 0 10px #00000080;height:50px;height:calc(50px + constant(safe-area-inset-bottom));height:calc(50px + env(safe-area-inset-bottom));padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom);display:flex;align-items:center;justify-content:center}ion-footer[_ngcontent-%COMP%] > div.footer-green[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{line-height:50px;font-size:16px;color:#fff;font-weight:600}ion-footer[_ngcontent-%COMP%] > div.footer-grey[_ngcontent-%COMP%]{width:100%;box-shadow:0 0 2px #485059;background:#485059;height:50px;height:calc(50px + constant(safe-area-inset-bottom));height:calc(50px + env(safe-area-inset-bottom));padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom);display:flex;align-items:center;justify-content:center}ion-footer[_ngcontent-%COMP%] > div.footer-grey[_ngcontent-%COMP%] > div.box[_ngcontent-%COMP%]{display:flex;align-items:center;height:16px}ion-footer[_ngcontent-%COMP%] > div.footer-grey[_ngcontent-%COMP%] > div.box[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{font-size:16px;color:#fff;font-weight:600}ion-footer[_ngcontent-%COMP%] > div.footer-grey[_ngcontent-%COMP%] > div.box[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:16px;color:#fff;height:16px;font-weight:600;line-height:16px;margin-top:0;margin-left:6px}']}),o})()}];let it=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[p.Bz.forChild(ot)],p.Bz]}),o})();var ct=c(9277),st=c(9721);let at=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[d.ez,v.u5,r.Pc,ct.G,st.x,it]]}),o})()}}]);