"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8842],{5732:(y,g,o)=>{o.d(g,{$:()=>u});var s=o(9863);let u=(()=>{class a{constructor(){}ngOnInit(){}}return a.\u0275fac=function(r){return new(r||a)},a.\u0275cmp=s.Xpm({type:a,selectors:[["app-wechat-open-page"]],decls:7,vars:0,consts:[[1,"weui-mask"],[1,"weui-dialog"],[1,"weui-dialog__bd"],[1,"weui-dialog__ft"],["href","weixin://","onclick","",1,"weui-dialog__btn","weui-dialog__btn_default"]],template:function(r,v){1&r&&(s.TgZ(0,"div",0)(1,"div",1)(2,"div",2),s._uU(3,"\u8bf7\u5728\u624b\u673a\u7aef\u6253\u5f00\u9875\u9762"),s.qZA(),s.TgZ(4,"div",3)(5,"a",4),s._uU(6,"\u786e\u5b9a"),s.qZA()()()())},styles:[""]}),a})()},8842:(y,g,o)=>{o.r(g),o.d(g,{ActivityPageModule:()=>U});var s=o(9808),u=o(3075),a=o(8962),l=o(1192),r=o(655),v=o(4157),_=o(7846),h=o(5098),d=o(8995),t=o(9863),m=o(947),C=o(9993),P=o(5830),M=o(2e3),O=o(4828),x=o(9609),b=o(5161),A=o(5732),I=o(7873),T=o(1656);const R=["appStatusContent"];function w(e,c){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"app-status-content",3,4),t.NdJ("retry",function(){return t.CHM(n),t.oxw().onRetry()}),t._UZ(3,"app-wechat-open-page"),t.qZA(),t.BQk()}}function Z(e,c){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"app-status-content",3,4),t.NdJ("retry",function(){return t.CHM(n),t.oxw().onRetry()}),t.TgZ(3,"div",5),t._uU(4,"pad layout here"),t.qZA()(),t.BQk()}}function S(e,c){if(1&e&&(t._UZ(0,"div",9),t.ALo(1,"safeHtml")),2&e){const n=t.oxw(2);t.Q6J("innerHtml",t.lcZ(1,1,n.activityInfo.content),t.oJD)}}function B(e,c){if(1&e&&(t.TgZ(0,"div",10),t._UZ(1,"img",11),t.qZA()),2&e){const n=t.oxw(2);t.xp6(1),t.Q6J("src",n.activityInfo.thumbnail,t.LSH)}}function F(e,c){if(1&e&&(t.TgZ(0,"div",16)(1,"span"),t._uU(2," \u53c2\u4e0e\u6d3b\u52a8\u8d39\u7528\uff1a"),t.qZA(),t.TgZ(3,"span"),t._uU(4),t.qZA()()),2&e){const n=t.oxw(3);t.xp6(4),t.hij("\uffe5",n.activityInfo.price,"")}}function J(e,c){if(1&e&&(t.TgZ(0,"div",12)(1,"div",13)(2,"span"),t._uU(3),t.qZA()(),t.YNc(4,F,5,1,"div",14),t._UZ(5,"div",15),t.ALo(6,"safeHtml"),t.qZA()),2&e){const n=t.oxw(2);t.xp6(3),t.Oqu(n.activityInfo.title),t.xp6(1),t.Q6J("ngIf",n.requirePayment),t.xp6(1),t.Q6J("innerHtml",t.lcZ(6,3,n.activityInfo.content),t.oJD)}}function k(e,c){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"app-status-content",3,4),t.NdJ("retry",function(){return t.CHM(n),t.oxw().onRetry()}),t.TgZ(3,"div",5),t.YNc(4,S,2,3,"div",6),t.YNc(5,B,2,1,"div",7),t.YNc(6,J,7,5,"div",8),t.qZA()(),t.BQk()}if(2&e){const n=t.oxw();t.xp6(4),t.Q6J("ngIf",n.rightBarRemarks),t.xp6(1),t.Q6J("ngIf",!n.rightBarRemarks),t.xp6(1),t.Q6J("ngIf",!n.rightBarRemarks)}}function E(e,c){if(1&e){const n=t.EpF();t.TgZ(0,"span",19),t.NdJ("click",function(){return t.CHM(n),t.oxw(2).onClickPreBuyCode()}),t._uU(1,"\u5373\u5c06\u5f00\u653e"),t.qZA()}}function Y(e,c){if(1&e&&(t.TgZ(0,"ion-footer")(1,"div",17),t.YNc(2,E,2,0,"span",18),t.qZA()()),2&e){const n=t.oxw();t.xp6(2),t.Q6J("ngIf",n.requirePayment&&(!n.tripCode||!n.channel))}}const j=[{path:"",component:(()=>{class e extends _.n{constructor(n,i,p,f,z,D,L,W,G,X,$,V){super(n,i,p,f),this.loadingCtrl=n,this.toastCtrl=i,this.runtime=p,this.screenFitService=f,this.navCtrl=z,this.modalCtrl=D,this.api=L,this.router=W,this.store=G,this.eventBus=X,this.routeInfo=$,this.themeService=V,this.subscribeResult=null,this.routeInfoSubscribeResult=null,this.routeInfo2SubscribeResult=null,this.activityId=null,this.activityInfo={},this.orderNumber="",this.tripCode="",this.channel="",this.requirePayment=!0,this.rightBarRemarks="1"}ngOnInit(){this.subscribeResult=this.router.events.subscribe(n=>{}),this.routeInfoSubscribeResult=this.routeInfo.params.subscribe(n=>{this.activityId=n.activityId}),this.routeInfo2SubscribeResult=this.routeInfo.queryParams.subscribe(n=>{this.tripCode=n.code,this.channel=n.channel,n.ch&&(this.channel=n.ch)})}ngOnDestroy(){this.subscribeResult&&(this.subscribeResult.unsubscribe(),this.subscribeResult=null),this.routeInfoSubscribeResult&&(this.routeInfoSubscribeResult.unsubscribe(),this.routeInfoSubscribeResult=null),this.routeInfo2SubscribeResult&&(this.routeInfo2SubscribeResult.unsubscribe(),this.routeInfo2SubscribeResult=null)}initData(){return(0,r.mG)(this,void 0,void 0,function*(){yield Promise.all([this.fetchActivityInfo()]),this.runtime.token&&this.tripCode&&this.channel&&(()=>(0,r.mG)(this,void 0,void 0,function*(){yield this.exchangeWithTripCode()}))().catch(n=>{console.error(n)}),this.appStatusContent.invokeSuccess()})}setPageTitle(n){super.setPageTitle(n),this.eventBus.emmitEvent("changeNavTitle",n),this.eventBus.emmitEvent("changeDefaultHeader","standard"),this.eventBus.emmitEvent("changeShowRightBar","none")}ionViewWillEnter(){const n=this.runtime.merchantResourceMap.get("right-bar-title");this.setPageTitle(n||"\u6d3b\u52a8")}ionViewDidEnter(){(()=>(0,r.mG)(this,void 0,void 0,function*(){yield this.initData()}))().catch(n=>{console.error("[init data errror]",n),this.appStatusContent.invokeError()})}onRetry(){(()=>(0,r.mG)(this,void 0,void 0,function*(){yield this.initData()}))().catch(n=>{console.error("[init data errror]",n),this.appStatusContent.invokeError()})}back(){this.navCtrl.back()}checkLoginState(){return!!this.runtime.token||(this.router.navigate(["/login"],{queryParams:{source:`/zoo-activity/${this.activityId}`,from:"activity",activityId:this.activityId,activityCode:this.tripCode,channel:this.channel}}),!1)}onClickActivityCheckIn(){if(this.checkLoginState()){const n=d.w.convertRouteURL(this.router,["/zoo-check-in",this.activityId]);d.w.locationReplace(n)}}onClickPreBuyCode(){this.showToast("\u5373\u5c06\u5f00\u653e"),this.checkLoginState()}onClickBindTicketCode(){if(this.checkLoginState()){const n=d.w.convertRouteURL(this.router,["/bind-ticket-code",this.activityId]);d.w.locationReplace(n)}}exchangeWithTripCode(){return(0,r.mG)(this,void 0,void 0,function*(){const n=(0,v.d8)(h.y,yield this.api.joinWithTripCode(this.activityId,this.tripCode,this.channel));if(200!=n.code)return 521==n.code?void this.showToast("\u8be5\u7801\u5df2\u88ab\u4f7f\u7528"):623==n.code?void this.showToast("\u65e0\u6548\u7801\u6216\u672a\u6838\u9a8c\u7801"):624==n.code?void(this.requirePayment=!1):Promise.reject({code:n.code,message:n.msg});this.requirePayment=!1})}fetchActivityInfo(){return(0,r.mG)(this,void 0,void 0,function*(){const n=(0,v.d8)(h.y,yield this.api.fetchActivityInfo(this.activityId));if(200!=n.code)return Promise.reject({code:n.code,message:n.msg});{const i=n.data;this.activityInfo={uid:i.id,channel:i.channel,isOver:i.isOver,title:i.name,description:i.desc,price:i.price,content:i.content,isJoined:i.isJoined,startTime:i.startTime,endTime:i.endTime,thumbnail:i.thumbnail},this.activityInfo.isJoined&&(this.requirePayment=!1)}})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(a.HT),t.Y36(a.yF),t.Y36(m.t),t.Y36(C.v),t.Y36(a.SH),t.Y36(a.IN),t.Y36(P.s),t.Y36(l.F0),t.Y36(M.d),t.Y36(O.Y),t.Y36(l.gz),t.Y36(x.f))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-activity"]],viewQuery:function(n,i){if(1&n&&t.Gf(R,5),2&n){let p;t.iGM(p=t.CRH())&&(i.appStatusContent=p.first)}},features:[t.qOj],decls:7,vars:10,consts:[["id","pageContent",3,"fullscreen","scrollEvents"],[1,"page-root","activity"],[4,"ngIf"],[3,"retry"],["appStatusContent",""],[1,"app-container"],["class","detail rich-text-buffer",3,"innerHtml",4,"ngIf"],["class","thumbnail",4,"ngIf"],["class","content",4,"ngIf"],[1,"detail","rich-text-buffer",3,"innerHtml"],[1,"thumbnail"],[3,"src"],[1,"content"],[1,"title"],["class","price",4,"ngIf"],[1,"zoo-detail","rich-text",3,"innerHtml"],[1,"price"],[1,"footer"],[3,"click",4,"ngIf"],[3,"click"]],template:function(n,i){1&n&&(t.TgZ(0,"ion-content",0)(1,"div",1),t.YNc(2,w,4,0,"ng-container",2),t.YNc(3,Z,5,0,"ng-container",2),t.YNc(4,k,7,3,"ng-container",2),t.qZA(),t._UZ(5,"app-common-footer"),t.qZA(),t.YNc(6,Y,3,1,"ion-footer",2)),2&n&&(t.Tol(i.screenFitService.screenCategory),t.Q6J("fullscreen",i.themeService.immersive)("scrollEvents",!0),t.xp6(1),t.Tol(i.screenFitService.screenCategory),t.xp6(1),t.Q6J("ngIf","desktop"==i.screenFitService.screenCategory),t.xp6(1),t.Q6J("ngIf","pad"==i.screenFitService.screenCategory),t.xp6(1),t.Q6J("ngIf","phone"==i.screenFitService.screenCategory),t.xp6(2),t.Q6J("ngIf","phone"==i.screenFitService.screenCategory))},directives:[a.W2,s.O5,b.D,A.$,I.X,a.fr],pipes:[T.z],styles:['@charset "UTF-8";.flex-col[_ngcontent-%COMP%]{display:flex;flex-direction:column}.flex-row[_ngcontent-%COMP%]{display:flex;flex-direction:row}.justify-start[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.justify-center[_ngcontent-%COMP%]{display:flex;justify-content:center}.justify-end[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.justify-evenly[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.justify-around[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.justify-between[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.align-start[_ngcontent-%COMP%]{display:flex;align-items:flex-start}.align-center[_ngcontent-%COMP%]{display:flex;align-items:center}.align-end[_ngcontent-%COMP%]{display:flex;align-items:flex-end}div.page-root.activity[_ngcontent-%COMP%]{position:relative;color:#fff;letter-spacing:1px;font-size:16px}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]{width:100%}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]{padding:0;height:100vh}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%] > div.detail[_ngcontent-%COMP%]{margin:0 auto;width:100%;padding-bottom:0}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.thumbnail[_ngcontent-%COMP%]{position:relative;width:100%;height:180px;background-color:#2b333a}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.thumbnail[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{display:block;width:100%;height:180px}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.thumbnail[_ngcontent-%COMP%]:after{position:absolute;display:block;content:"";width:100%;height:30%;left:0;bottom:0}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%]{width:100%;background-color:#2b333a}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.title[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;padding:20px}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.title[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-weight:600;font-size:24px}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.price[_ngcontent-%COMP%]{overflow:hidden;margin:0 auto;width:calc(100% - 30px);background-color:#252c32;color:#eed1b3}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.price[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:nth-of-type(1){padding:15px;float:left}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.price[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:nth-of-type(2){float:right;padding:10px;font-size:20px}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.zoo-detail[_ngcontent-%COMP%]{margin:20px auto 0;width:calc(100% - 30px);padding-bottom:20px}div.page-root.activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.detail[_ngcontent-%COMP%]{margin:0 auto;width:100%;padding-bottom:0}ion-footer[_ngcontent-%COMP%]{width:100%}ion-footer[_ngcontent-%COMP%]   div.footer[_ngcontent-%COMP%]{width:100%;height:50px;height:calc(50px + constant(safe-area-inset-bottom));height:calc(50px + env(safe-area-inset-bottom));box-shadow:0 0 2px #485059;background:#485059;text-align:center;display:flex;align-items:center;padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom)}ion-footer[_ngcontent-%COMP%]   div.footer[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{position:relative;display:block;width:auto;flex:1;color:#eed1b3;line-height:60px;font-size:16px}ion-footer[_ngcontent-%COMP%]   div.footer[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:not(:first-of-type):after{position:absolute;display:block;content:"";left:0;top:calc(50% - 10px);width:1px;height:20px;background-color:#fff3}']}),e})()}];let Q=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[l.Bz.forChild(j)],l.Bz]}),e})();var H=o(9277),N=o(9721);let U=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[s.ez,u.u5,a.Pc,H.G,N.x,Q]]}),e})()}}]);