"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2023],{5732:(y,l,i)=>{i.d(l,{$:()=>g});var r=i(9863);let g=(()=>{class a{constructor(){}ngOnInit(){}}return a.\u0275fac=function(p){return new(p||a)},a.\u0275cmp=r.Xpm({type:a,selectors:[["app-wechat-open-page"]],decls:7,vars:0,consts:[[1,"weui-mask"],[1,"weui-dialog"],[1,"weui-dialog__bd"],[1,"weui-dialog__ft"],["href","weixin://","onclick","",1,"weui-dialog__btn","weui-dialog__btn_default"]],template:function(p,v){1&p&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2),r._uU(3,"\u8bf7\u5728\u624b\u673a\u7aef\u6253\u5f00\u9875\u9762"),r.qZA(),r.TgZ(4,"div",3)(5,"a",4),r._uU(6,"\u786e\u5b9a"),r.qZA()()()())},styles:[""]}),a})()},2023:(y,l,i)=>{i.r(l),i.d(l,{ZooActivityPageModule:()=>U});var r=i(9808),g=i(3075),a=i(8962),u=i(1192),p=i(655),v=i(4157),_=i(7846),h=i(5098),d=i(8995),t=i(9863),C=i(947),P=i(9993),m=i(5830),x=i(2e3),M=i(4828),O=i(9609),b=i(5161),Z=i(5732),A=i(7873),I=i(1656);const T=["appStatusContent"];function S(e,c){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"app-status-content",3,4),t.NdJ("retry",function(){return t.CHM(n),t.oxw().onRetry()}),t._UZ(3,"app-wechat-open-page"),t.qZA(),t.BQk()}}function w(e,c){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"app-status-content",3,4),t.NdJ("retry",function(){return t.CHM(n),t.oxw().onRetry()}),t.TgZ(3,"div",5),t._uU(4,"pad layout here"),t.qZA()(),t.BQk()}}function R(e,c){if(1&e&&(t.TgZ(0,"div",12)(1,"span"),t._uU(2," \u53c2\u4e0e\u6d3b\u52a8\u8d39\u7528\uff1a"),t.qZA(),t.TgZ(3,"span"),t._uU(4),t.qZA()()),2&e){const n=t.oxw(2);t.xp6(4),t.hij("\uffe5",n.activityInfo.price,"")}}function z(e,c){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"app-status-content",3,4),t.NdJ("retry",function(){return t.CHM(n),t.oxw().onRetry()}),t.TgZ(3,"div",5)(4,"div",6),t._UZ(5,"img",7),t.qZA(),t.TgZ(6,"div",8)(7,"div",9)(8,"span"),t._uU(9),t.qZA()(),t.YNc(10,R,5,1,"div",10),t._UZ(11,"div",11),t.ALo(12,"safeHtml"),t.qZA()()(),t.BQk()}if(2&e){const n=t.oxw();t.xp6(5),t.Q6J("src",n.activityInfo.thumbnail,t.LSH),t.xp6(4),t.Oqu(n.activityInfo.title),t.xp6(1),t.Q6J("ngIf",n.requirePayment),t.xp6(1),t.Q6J("innerHtml",t.lcZ(12,4,n.activityInfo.content),t.oJD)}}function E(e,c){if(1&e){const n=t.EpF();t.TgZ(0,"span",15),t.NdJ("click",function(){return t.CHM(n),t.oxw(2).onClickActivityCheckIn()}),t._uU(1,"\u7acb\u5373\u53c2\u4e0e"),t.qZA()}}function k(e,c){if(1&e){const n=t.EpF();t.TgZ(0,"span",15),t.NdJ("click",function(){return t.CHM(n),t.oxw(2).onClickBindTicketCode()}),t._uU(1),t.qZA()}if(2&e){const n=t.oxw(2);t.xp6(1),t.Oqu(n.tripCode&&n.channel?"\u7acb\u5373\u53c2\u4e0e":"\u5957\u7968\u5151\u6362")}}function F(e,c){if(1&e){const n=t.EpF();t.TgZ(0,"span",15),t.NdJ("click",function(){return t.CHM(n),t.oxw(2).onClickPreBuyCode()}),t._uU(1,"\u7acb\u5373\u8d2d\u4e70"),t.qZA()}}function B(e,c){if(1&e&&(t.TgZ(0,"ion-footer")(1,"div",13),t.YNc(2,E,2,0,"span",14),t.YNc(3,k,2,1,"span",14),t.YNc(4,F,2,0,"span",14),t.qZA()()),2&e){const n=t.oxw();t.xp6(2),t.Q6J("ngIf",!n.requirePayment),t.xp6(1),t.Q6J("ngIf",n.requirePayment),t.xp6(1),t.Q6J("ngIf",n.requirePayment&&(!n.tripCode||!n.channel))}}const J=[{path:"",component:(()=>{class e extends _.n{constructor(n,o,s,f,Q,D,H,W,G,L,X,$){super(n,o,s,f),this.loadingCtrl=n,this.toastCtrl=o,this.runtime=s,this.screenFitService=f,this.navCtrl=Q,this.modalCtrl=D,this.api=H,this.router=W,this.store=G,this.eventBus=L,this.routeInfo=X,this.themeService=$,this.subscribeResult=null,this.routeInfoSubscribeResult=null,this.routeInfo2SubscribeResult=null,this.activityId=null,this.activityInfo={},this.orderNumber="",this.tripCode="",this.channel="",this.requirePayment=!0}ngOnInit(){this.subscribeResult=this.router.events.subscribe(n=>{n instanceof u.m2&&"/zoo-activity"==n.url&&this.setPageTitle("\u4eb2\u5b50\u6d3b\u52a8")}),this.routeInfoSubscribeResult=this.routeInfo.params.subscribe(n=>{this.activityId=n.activityId}),this.routeInfo2SubscribeResult=this.routeInfo.queryParams.subscribe(n=>{this.tripCode=n.code,this.channel=n.channel,n.ch&&(this.channel=n.ch)})}ngOnDestroy(){this.subscribeResult&&(this.subscribeResult.unsubscribe(),this.subscribeResult=null),this.routeInfoSubscribeResult&&(this.routeInfoSubscribeResult.unsubscribe(),this.routeInfoSubscribeResult=null),this.routeInfo2SubscribeResult&&(this.routeInfo2SubscribeResult.unsubscribe(),this.routeInfo2SubscribeResult=null)}initData(){return(0,p.mG)(this,void 0,void 0,function*(){yield Promise.all([this.fetchActivityInfo()]),this.runtime.token&&this.tripCode&&this.channel&&(()=>(0,p.mG)(this,void 0,void 0,function*(){yield this.exchangeWithTripCode()}))().catch(n=>{console.error(n)}),this.appStatusContent.invokeSuccess()})}setPageTitle(n){super.setPageTitle(n),this.eventBus.emmitEvent("changeNavTitle",n),this.eventBus.emmitEvent("changeDefaultHeader","standard"),this.eventBus.emmitEvent("changeShowRightBar","none")}ionViewWillEnter(){this.setPageTitle("\u4eb2\u5b50\u6d3b\u52a8")}ionViewDidEnter(){(()=>(0,p.mG)(this,void 0,void 0,function*(){yield this.initData()}))().catch(n=>{console.error("[init data errror]",n),this.appStatusContent.invokeError()})}onRetry(){(()=>(0,p.mG)(this,void 0,void 0,function*(){yield this.initData()}))().catch(n=>{console.error("[init data errror]",n),this.appStatusContent.invokeError()})}back(){this.navCtrl.back()}checkLoginState(){return!!this.runtime.token||(this.router.navigate(["/login"],{queryParams:{source:`/zoo-activity/${this.activityId}`,from:"activity",activityId:this.activityId,activityCode:this.tripCode,channel:this.channel}}),!1)}onClickActivityCheckIn(){if(this.checkLoginState()){const n=d.w.convertRouteURL(this.router,["/zoo-check-in",this.activityId]);d.w.locationReplace(n)}}onClickPreBuyCode(){this.checkLoginState()&&this.router.navigate(["/payment/activity"],{queryParams:{activityId:this.activityId}})}onClickBindTicketCode(){if(this.checkLoginState()){const n=d.w.convertRouteURL(this.router,["/bind-ticket-code",this.activityId]);d.w.locationReplace(n)}}exchangeWithTripCode(){return(0,p.mG)(this,void 0,void 0,function*(){const n=(0,v.d8)(h.y,yield this.api.joinWithTripCode(this.activityId,this.tripCode,this.channel));if(200!=n.code)return 521==n.code?void this.showToast("\u8be5\u7801\u5df2\u88ab\u4f7f\u7528"):623==n.code?void this.showToast("\u65e0\u6548\u7801\u6216\u672a\u6838\u9a8c\u7801"):624==n.code?void(this.requirePayment=!1):Promise.reject({code:n.code,message:n.msg});this.requirePayment=!1})}fetchActivityInfo(){return(0,p.mG)(this,void 0,void 0,function*(){const n=(0,v.d8)(h.y,yield this.api.fetchActivityInfo(this.activityId));if(200!=n.code)return Promise.reject({code:n.code,message:n.msg});{const o=n.data;this.activityInfo={uid:o.id,channel:o.channel,isOver:o.isOver,title:o.name,description:o.desc,price:o.price,content:o.content,isJoined:o.isJoined,startTime:o.startTime,endTime:o.endTime,thumbnail:o.thumbnail},this.activityInfo.isJoined&&(this.requirePayment=!1)}})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(a.HT),t.Y36(a.yF),t.Y36(C.t),t.Y36(P.v),t.Y36(a.SH),t.Y36(a.IN),t.Y36(m.s),t.Y36(u.F0),t.Y36(x.d),t.Y36(M.Y),t.Y36(u.gz),t.Y36(O.f))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-zoo-activity"]],viewQuery:function(n,o){if(1&n&&t.Gf(T,5),2&n){let s;t.iGM(s=t.CRH())&&(o.appStatusContent=s.first)}},features:[t.qOj],decls:7,vars:10,consts:[["id","pageContent",3,"fullscreen","scrollEvents"],[1,"page-root","zoo-activity"],[4,"ngIf"],[3,"retry"],["appStatusContent",""],[1,"app-container"],[1,"thumbnail"],[3,"src"],[1,"content"],[1,"title"],["class","price",4,"ngIf"],[1,"zoo-detail","rich-text",3,"innerHtml"],[1,"price"],[1,"footer"],[3,"click",4,"ngIf"],[3,"click"]],template:function(n,o){1&n&&(t.TgZ(0,"ion-content",0)(1,"div",1),t.YNc(2,S,4,0,"ng-container",2),t.YNc(3,w,5,0,"ng-container",2),t.YNc(4,z,13,6,"ng-container",2),t.qZA(),t._UZ(5,"app-common-footer"),t.qZA(),t.YNc(6,B,5,3,"ion-footer",2)),2&n&&(t.Tol(o.screenFitService.screenCategory),t.Q6J("fullscreen",o.themeService.immersive)("scrollEvents",!0),t.xp6(1),t.Tol(o.screenFitService.screenCategory),t.xp6(1),t.Q6J("ngIf","desktop"==o.screenFitService.screenCategory),t.xp6(1),t.Q6J("ngIf","pad"==o.screenFitService.screenCategory),t.xp6(1),t.Q6J("ngIf","phone"==o.screenFitService.screenCategory),t.xp6(2),t.Q6J("ngIf","phone"==o.screenFitService.screenCategory))},directives:[a.W2,r.O5,b.D,Z.$,A.X,a.fr],pipes:[I.z],styles:['@charset "UTF-8";.flex-col[_ngcontent-%COMP%]{display:flex;flex-direction:column}.flex-row[_ngcontent-%COMP%]{display:flex;flex-direction:row}.justify-start[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.justify-center[_ngcontent-%COMP%]{display:flex;justify-content:center}.justify-end[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.justify-evenly[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.justify-around[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.justify-between[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.align-start[_ngcontent-%COMP%]{display:flex;align-items:flex-start}.align-center[_ngcontent-%COMP%]{display:flex;align-items:center}.align-end[_ngcontent-%COMP%]{display:flex;align-items:flex-end}div.page-root.zoo-activity[_ngcontent-%COMP%]{position:relative;color:#fff;letter-spacing:1px;font-size:16px}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]{background-color:#2b333a}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]{width:100%}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]{padding:0}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.thumbnail[_ngcontent-%COMP%]{position:relative;width:100%;height:180px}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.thumbnail[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{display:block;width:100%;height:180px}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.thumbnail[_ngcontent-%COMP%]:after{position:absolute;display:block;content:"";width:100%;height:30%;left:0;bottom:0}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%]{width:100%}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.title[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;padding:20px}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.title[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-weight:600;font-size:24px}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.price[_ngcontent-%COMP%]{overflow:hidden;margin:0 auto;width:calc(100% - 30px);background-color:#252c32;color:#eed1b3}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.price[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:nth-of-type(1){padding:15px;float:left}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.price[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:nth-of-type(2){float:right;padding:10px;font-size:20px}div.page-root.zoo-activity.phone[_ngcontent-%COMP%]   app-status-content[_ngcontent-%COMP%]   div.app-container[_ngcontent-%COMP%]   div.content[_ngcontent-%COMP%] > div.zoo-detail[_ngcontent-%COMP%]{margin:20px auto 0;width:calc(100% - 30px);padding-bottom:20px}ion-footer[_ngcontent-%COMP%]{width:100%}ion-footer[_ngcontent-%COMP%]   div.footer[_ngcontent-%COMP%]{width:100%;height:50px;height:calc(50px + constant(safe-area-inset-bottom));height:calc(50px + env(safe-area-inset-bottom));box-shadow:0 0 2px #485059;background:#485059;text-align:center;display:flex;align-items:center;padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom)}ion-footer[_ngcontent-%COMP%]   div.footer[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{position:relative;display:block;width:auto;flex:1;color:#eed1b3;line-height:60px;font-size:16px}ion-footer[_ngcontent-%COMP%]   div.footer[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:not(:first-of-type):after{position:absolute;display:block;content:"";left:0;top:calc(50% - 10px);width:1px;height:20px;background-color:#fff3}']}),e})()}];let Y=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[u.Bz.forChild(J)],u.Bz]}),e})();var j=i(9277),N=i(9721);let U=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[r.ez,g.u5,a.Pc,j.G,N.x,Y]]}),e})()}}]);